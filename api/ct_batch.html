
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CTImagesBatch &#8212; RadIO 0.1.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CTImagesMaskedBatch" href="masked_batch.html" />
    <link rel="prev" title="API" href="api.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="masked_batch.html" title="CTImagesMaskedBatch"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RadIO 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="api.html" accesskey="U">API</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ctimagesbatch">
<h1>CTImagesBatch<a class="headerlink" href="#ctimagesbatch" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="radio.CTImagesBatch">
<em class="property">class </em><code class="descclassname">radio.</code><code class="descname">CTImagesBatch</code><span class="sig-paren">(</span><em>index</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Batch class for storing batch of CT-scans in 3D.</p>
<p>Contains a component <cite>images</cite> = 3d-array of stacked scans
along number_of_slices (z) axis (aka “skyscraper”), associated information
for subsetting individual patient’s 3D scan (_bounds, origin, spacing) and
various methods to preprocess the data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>index</strong> (<em>dataset.index</em>) – ids of scans to be put in a batch</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="CTImagesBatch.components">
<code class="descname">components</code><a class="headerlink" href="#CTImagesBatch.components" title="Permalink to this definition">¶</a></dt>
<dd><p><em>tuple of strings.</em> – List names of data components of a batch, which are <cite>images</cite>,
<cite>origin</cite> and <cite>spacing</cite>.
NOTE: Implementation of this attribute is required by Base class.</p>
</dd></dl>

<dl class="attribute">
<dt id="CTImagesBatch.index">
<code class="descname">index</code><a class="headerlink" href="#CTImagesBatch.index" title="Permalink to this definition">¶</a></dt>
<dd><p><em>dataset.index</em> – represents indices of scans from a batch</p>
</dd></dl>

<dl class="attribute">
<dt id="CTImagesBatch.images">
<code class="descname">images</code><a class="headerlink" href="#CTImagesBatch.images" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray</em> – contains ct-scans for all patients in batch.</p>
</dd></dl>

<dl class="attribute">
<dt id="CTImagesBatch.spacing">
<code class="descname">spacing</code><a class="headerlink" href="#CTImagesBatch.spacing" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray of floats</em> – represents distances between pixels in world coordinates</p>
</dd></dl>

<dl class="attribute">
<dt id="CTImagesBatch.origin">
<code class="descname">origin</code><a class="headerlink" href="#CTImagesBatch.origin" title="Permalink to this definition">¶</a></dt>
<dd><p><em>ndarray of floats</em> – contains world coordinates of (0, 0, 0)-pixel of scans</p>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.calc_lung_mask">
<code class="descname">calc_lung_mask</code><span class="sig-paren">(</span><em>patient</em>, <em>out_patient</em>, <em>res</em>, <em>erosion_radius</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.calc_lung_mask"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.calc_lung_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a mask for lungs</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>erosion_radius</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – radius of erosion to be performed.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.central_crop">
<code class="descname">central_crop</code><span class="sig-paren">(</span><em>crop_size</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.central_crop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.central_crop" title="Permalink to this definition">¶</a></dt>
<dd><p>Make crop of crop_size from center of images.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>crop_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-shape of crop.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">batch</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="radio.CTImagesBatch.components">
<code class="descname">components</code><em class="property"> = ('images', 'spacing', 'origin')</em><a class="headerlink" href="#radio.CTImagesBatch.components" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="radio.CTImagesBatch.concat">
<em class="property">classmethod </em><code class="descname">concat</code><span class="sig-paren">(</span><em>batches</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.concat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.concat" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenate several batches in one large batch.</p>
<p>Assume that same components are filled in all supplied batches.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>batches</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>tuple of batches</em>) – sequence of batches to be concatenated</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">large batch with length = sum of lengths of concated batches</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">batch</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Old batches’ indexes are dropped. New large batch has new
np-arange index.
if None-entries or batches of len=0 are included in the list of batches,
they will be dropped after concat.</p>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.dump">
<code class="descname">dump</code><span class="sig-paren">(</span><em>ix</em>, <em>dst</em>, <em>components=None</em>, <em>fmt='blosc'</em>, <em>index_to_name=None</em>, <em>i8_encoding_mode=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.dump"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump chosen <code class="docutils literal"><span class="pre">components</span></code> of scans’ batcn in folder <code class="docutils literal"><span class="pre">dst</span></code> in specified format.</p>
<p>When some of the <code class="docutils literal"><span class="pre">components</span></code> are <code class="docutils literal"><span class="pre">None</span></code>, a warning is printed and nothing is dumped.
By default (<code class="docutils literal"><span class="pre">components</span> <span class="pre">is</span> <span class="pre">None</span></code>) <code class="docutils literal"><span class="pre">dump</span></code> attempts to dump all components.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dst</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – destination-folder where all patients’ data should be put</li>
<li><strong>components</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em>, </em><em>ndarray of strings</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – component(s) that we need to dump (smth iterable or string). If not
supplied, dump all components</li>
<li><strong>fmt</strong> (<em>'blosc'</em>) – format of dump. Currently only blosc-format is supported;
in this case folder for each patient is created. Tree-structure of created
files is demonstrated in the example below.</li>
<li><strong>index_to_name</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.6)"><em>callable</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a>) – When supplied, should return str;
A function that relates each item’s index to a name of item’s folder.
That is, each item is dumped into os.path.join(dst, index_to_name(items_index)).
If None, no transformation is applied and the method attempts to use indices of batch-items
as names of items’ folders.</li>
<li><strong>i8_encoding_mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.6)"><em>dict</em></a>) – whether (and how) components of skyscraper-type should be cast to int8.
If None, no cast is performed. The cast allows to save space on disk and to speed up batch-loading.
However, it comes with loss of precision, as originally skyscraper-components are stored
in float32-format. Can be int: 0, 1, 2 or str/None: ‘linear’, ‘quantization’ or None.
0 or None disable the cast. 1 stands for ‘linear’, 2 - for ‘quantization’.
Can also be component-wise dict of modes, e.g.: {‘images’: ‘linear’, ‘masks’: 0}.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Initialize batch and load data</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1ae34g90&#39;</span><span class="p">,</span> <span class="s1">&#39;3hf82s76&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">CTImagesBatch</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s1">&#39;./data/blosc_preprocessed&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The command above creates following files:</p>
<ul class="simple">
<li>./data/blosc_preprocessed/1ae34g90/images/data.blk</li>
<li>./data/blosc_preprocessed/1ae34g90/images/data.shape</li>
<li>./data/blosc_preprocessed/1ae34g90/spacing/data.pkl</li>
<li>./data/blosc_preprocessed/1ae34g90/origin/data.pkl</li>
<li>./data/blosc_preprocessed/3hf82s76/images/data.blk</li>
<li>./data/blosc_preprocessed/3hf82s76/images/data.shape</li>
<li>./data/blosc_preprocessed/3hf82s76/spacing/data.pkl</li>
<li>./data/blosc_preprocessed/3hf82s76/origin/data.pkl</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.flip">
<code class="descname">flip</code><span class="sig-paren">(</span><em>patient</em>, <em>out_patient</em>, <em>res</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.flip"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.flip" title="Permalink to this definition">¶</a></dt>
<dd><p>Invert the order of slices for each patient</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">batch</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.get_axial_slice">
<code class="descname">get_axial_slice</code><span class="sig-paren">(</span><em>person_number</em>, <em>slice_height</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.get_axial_slice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.get_axial_slice" title="Permalink to this definition">¶</a></dt>
<dd><p>Get axial slice (e.g., for plots)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>person_number</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – Can be either index (int) of person in the batch
or patient_id (str)</li>
<li><strong>slice_height</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – scaled from 0 to 1 number of slice.
e.g. 0.7 means that we take slice with number
int(0.7 * number of slices for person)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray (view)</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Here self.index[5] usually smth like ‘a1de03fz29kf6h2’</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">patch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">get_axial_slice</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">patch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">get_axial_slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.get_patches">
<code class="descname">get_patches</code><span class="sig-paren">(</span><em>patch_shape</em>, <em>stride</em>, <em>padding='edge'</em>, <em>data_attr='images'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.get_patches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.get_patches" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract patches of patch_shape with specified stride.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>patch_shape</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-shape of a single patch.</li>
<li><strong>stride</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-stride to slide over each patient’s data.</li>
<li><strong>padding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – padding-type (see doc of np.pad for available types).</li>
<li><strong>data_attr</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – component to get data from.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">4d-ndaray of patches; first dimension enumerates patches</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Shape of all patients data is needed to be the same at this step,
resize/unify_spacing is required before.</p>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.get_pos">
<code class="descname">get_pos</code><span class="sig-paren">(</span><em>data</em>, <em>component</em>, <em>index</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.get_pos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.get_pos" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a positon of an item for a given index in data
or in self.`component`.</p>
<p>Fetch correct position inside batch for an item, looks for it
in <cite>data</cite>, if provided, or in <cite>component</cite> in self.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a><em> or </em><em>ndarray</em>) – data from which subsetting is done.
If None, retrieve position from <cite>component</cite> of batch,
if ndarray, returns index.</li>
<li><strong>component</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – name of a component, f.ex. ‘images’.
if component provided, data should be None.</li>
<li><strong>index</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – index of an item to be looked for.
may be key from dataset (str)
or index inside batch (int).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Position of item</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)">int</a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>This is an overload of get_pos from base Batch-class,
see corresponding docstring for detailed explanation.</p>
</dd></dl>

<dl class="attribute">
<dt id="radio.CTImagesBatch.images_shape">
<code class="descname">images_shape</code><a class="headerlink" href="#radio.CTImagesBatch.images_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Get shapes for all 3d scans in CTImagesBatch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">shapes of data for each patient, ndarray(patient_pos, 3)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.load">
<code class="descname">load</code><span class="sig-paren">(</span><em>fmt='dicom'</em>, <em>components=None</em>, <em>bounds=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load 3d scans data in batch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fmt</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – type of data. Can be ‘dicom’|’blosc’|’raw’|’ndarray’</li>
<li><strong>components</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em>, </em><em>ndarray of strings</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – Contains names of batch component(s) that should be loaded.
As of now, works only if fmt=’blosc’. If fmt != ‘blosc’, all
available components are loaded. If None and fmt = ‘blosc’, again,
all components are loaded.</li>
<li><strong>bounds</strong> (<em>ndarray</em><em>(</em><em>n_patients + 1</em><em>, </em><em>dtype=np.int</em><em>) or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a>) – Needed iff fmt=’ndarray’. Bound-floors for items from a <cite>skyscraper</cite>
(stacked scans).</li>
<li><strong>**kwargs</strong> – <dl class="docutils">
<dt>images <span class="classifier-delimiter">:</span> <span class="classifier">ndarray(n_patients * z, y, x) or None</span></dt>
<dd>Needed only if fmt = ‘ndarray’
input array containing <cite>skyscraper</cite> (stacked scans).</dd>
<dt>origin <span class="classifier-delimiter">:</span> <span class="classifier">ndarray(n_patients, 3) or None</span></dt>
<dd>Needed only if fmt=’ndarray’.
origins of scans in world coordinates.</dd>
<dt>spacing <span class="classifier-delimiter">:</span> <span class="classifier">ndarray(n_patients, 3) or None</span></dt>
<dd>Needed only if fmt=’ndarray’
ndarray with spacings of patients along <cite>z,y,x</cite> axes.</dd>
</dl>
</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">self</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>DICOM example
initialize batch for storing batch of 3 patients with following IDs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">FilesIndex</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/some/path/*.dcm&quot;</span><span class="p">,</span> <span class="n">no_ext</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">CTImagesBatch</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;dicom&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Ndarray example</p>
<p>images_array stores a set of 3d-scans concatted along 0-zxis, “skyscraper”.
Say, it is a ndarray with shape (400, 256, 256)</p>
<p>bounds stores ndarray of last floors for each scan.
say, bounds = np.asarray([0, 100, 400])</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ndarray&#39;</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">images_array</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.load_from_patches">
<code class="descname">load_from_patches</code><span class="sig-paren">(</span><em>patches</em>, <em>stride</em>, <em>scan_shape</em>, <em>data_attr='images'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.load_from_patches"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.load_from_patches" title="Permalink to this definition">¶</a></dt>
<dd><p>Get skyscraper from 4d-array of patches, put it to <cite>data_attr</cite> component in batch.</p>
<p>Let reconstruct original skyscraper from patches (if same arguments are passed)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>patches</strong> (<em>ndarray</em>) – 4d-array of patches, with dims: <cite>(num_patches, z, y, x)</cite>.</li>
<li><strong>scan_shape</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-shape of individual scan (should be same for all scans).</li>
<li><strong>stride</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-stride step used for gathering data from patches.</li>
<li><strong>data_attr</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – batch component name to store new data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>If stride != patch.shape(), averaging of overlapped regions is used.
<cite>scan_shape</cite>, patches.shape(), <cite>stride</cite> are used to infer the number of items
in new skyscraper. If patches were padded, padding is removed for skyscraper.</p>
</dd></dl>

<dl class="attribute">
<dt id="radio.CTImagesBatch.lower_bounds">
<code class="descname">lower_bounds</code><a class="headerlink" href="#radio.CTImagesBatch.lower_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Get lower bounds of patients data in CTImagesBatch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">ndarray(n_patients,) containing
lower bounds of patients data along z-axis.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.make_xip">
<code class="descname">make_xip</code><span class="sig-paren">(</span><em>depth</em>, <em>stride=1</em>, <em>mode='max'</em>, <em>projection='axial'</em>, <em>padding='reflect'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.make_xip"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.make_xip" title="Permalink to this definition">¶</a></dt>
<dd><p>Make intensity projection (maximum, minimum, mean or median).</p>
<p>Notice that axis is chosen according to projection argument.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>depth</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – number of slices over which xip operation is performed.</li>
<li><strong>stride</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – stride-step along projection dimension.</li>
<li><strong>mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – Possible values are ‘max’, ‘min’, ‘mean’ or ‘median’.</li>
<li><strong>projection</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – Possible values: ‘axial’, ‘coronal’, ‘sagital’.
In case of ‘coronal’ and ‘sagital’ projections tensor
will be transposed from [z,y,x] to [x,z,y] and [y,z,x].</li>
<li><strong>padding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – mode of padding that will be passed in numpy.padding function.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="radio.CTImagesBatch.merge">
<em class="property">classmethod </em><code class="descname">merge</code><span class="sig-paren">(</span><em>batches</em>, <em>batch_size=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.merge"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenate list of batches and then split the result in two batches of sizes
(batch_size, sum(lens of batches) - batch_size)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>batches</strong> (<em>list of batches</em>) – </li>
<li><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – length of first resulting batch</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(new_batch, rest_batch)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple of batches</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Merge performs split (of middle-batch) and then two concats
because of speed considerations.</p>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.normalize_hu">
<code class="descname">normalize_hu</code><span class="sig-paren">(</span><em>min_hu=-1000</em>, <em>max_hu=400</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.normalize_hu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.normalize_hu" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalize HU-densities to interval [0, 255].</p>
<p>Trim HU that are outside range [min_hu, max_hu], then scale to [0, 255].</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>min_hu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – minimum value for hu that will be used as trimming threshold.</li>
<li><strong>max_hu</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – maximum value for hu that will be used as trimming threshold.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">batch</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">normalize_hu</span><span class="p">(</span><span class="n">min_hu</span><span class="o">=-</span><span class="mi">1300</span><span class="p">,</span> <span class="n">max_hu</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.rescale">
<code class="descname">rescale</code><span class="sig-paren">(</span><em>new_shape</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.rescale"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.rescale" title="Permalink to this definition">¶</a></dt>
<dd><p>Recomputes spacing values for patients’ data after resize.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>new_shape</strong> (<em>ndarray</em><em>(</em><em>dtype=np.int</em><em>)</em>) – shape of patient 3d array after resize,
in format np.array([z_dim, y_dim, x_dim], dtype=np.int).</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">ndarray(n_patients, 3) with spacing values for each
patient along z, y, x axes.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.resize">
<code class="descname">resize</code><span class="sig-paren">(</span><em>patient</em>, <em>out_patient</em>, <em>res</em>, <em>shape=(128</em>, <em>256</em>, <em>256)</em>, <em>method='pil-simd'</em>, <em>axes_pairs=None</em>, <em>resample=None</em>, <em>order=3</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.resize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.resize" title="Permalink to this definition">¶</a></dt>
<dd><p>Resize (change shape of) each CT-scan in the batch.</p>
<p>When called from a batch, changes this batch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>shape</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-shape that should be AFTER resize.
Note, that ct-scan dim_ordering also should be <cite>z,y,x</cite></li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – interpolation package to be used. Either ‘pil-simd’ or ‘scipy’.
Pil-simd ensures better quality and speed on configurations
with average number of cores. On the contrary, scipy is better scaled and
can show better performance on systems with large number of cores</li>
<li><strong>axes_pairs</strong> (<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a><em> or </em><em>list/tuple of tuples with pairs</em>) – pairs of axes that will be used for performing pil-simd resize,
as this resize is made in 2d. Min number of pairs to use is 1,
at max there can be 6 pairs. If None, set to ((0, 1), (1, 2)).
The more pairs one uses, the more precise is the result.
(and computation takes more time).</li>
<li><strong>resample</strong> (<em>filter of pil-simd resize. By default set to bilinear. Can be any of filters</em>) – supported by PIL.Image.</li>
<li><strong>order</strong> (<em>the order of scipy-interpolation</em><em> (</em><em>&lt;= 5</em><em>)</em>) – large value improves precision, but slows down the computaion.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.rotate">
<code class="descname">rotate</code><span class="sig-paren">(</span><em>index</em>, <em>angle</em>, <em>components='images'</em>, <em>axes=(1</em>, <em>2)</em>, <em>random=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.rotate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.rotate" title="Permalink to this definition">¶</a></dt>
<dd><p>Rotate 3D images in batch on specific angle in plane.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>angle</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.6)"><em>float</em></a>) – degree of rotation.</li>
<li><strong>components</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em>, </em><em>ndarray of strings</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – name(s) of components to rotate each item in it.</li>
<li><strong>axes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (int, int), plane of rotation specified by two axes (zyx-ordering).</li>
<li><strong>random</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.6)"><em>bool</em></a>) – if True, then degree specifies maximum angle of rotation.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">ndarray of 3D rotated image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>zero padding automatically added after rotation.
Use this action in the end of pipelines for purposes of augmentation.
E.g., after <a class="reference internal" href="masked_batch.html#radio.preprocessing.ct_masked_batch.CTImagesMaskedBatch.sample_nodules" title="radio.preprocessing.ct_masked_batch.CTImagesMaskedBatch.sample_nodules"><code class="xref py py-func docutils literal"><span class="pre">sample_nodules()</span></code></a></p>
<p class="rubric">Examples</p>
<p>Rotate images on 90 degrees:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">random</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Random rotation with maximum angle:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.segment">
<code class="descname">segment</code><span class="sig-paren">(</span><em>erosion_radius=2</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.segment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.segment" title="Permalink to this definition">¶</a></dt>
<dd><p>Segment lungs’ content from 3D array.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>erosion_radius</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – radius of erosion to be performed.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">batch</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Sets HU of every pixel outside lungs to DARK_HU = -2000.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">erosion_radius</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_threads</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="radio.CTImagesBatch.slice_shape">
<code class="descname">slice_shape</code><a class="headerlink" href="#radio.CTImagesBatch.slice_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Get shape of slice in yx-plane.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">ndarray([y_dim, x_dim],dtype=np.int) with shape of scan slice.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="radio.CTImagesBatch.split">
<em class="property">classmethod </em><code class="descname">split</code><span class="sig-paren">(</span><em>batch</em>, <em>batch_size</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.split"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.split" title="Permalink to this definition">¶</a></dt>
<dd><p>Split one batch in two batches.</p>
<p>The lens of 2 batches would be <cite>batch_size</cite> and <cite>len(batch) - batch_size</cite></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>batch</strong> (<em>Batch class instance</em>) – batch to be splitted in two</li>
<li><strong>batch_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – length of first returned batch.
If batch_size &gt;= len(batch), return None instead of a 2nd batch</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">(1st_Batch, 2nd_Batch)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple of batches</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Method does not change the structure of input Batch.index. Indices of output
batches are simply subsets of input Batch.index.</p>
</dd></dl>

<dl class="method">
<dt id="radio.CTImagesBatch.unify_spacing">
<code class="descname">unify_spacing</code><span class="sig-paren">(</span><em>patient</em>, <em>out_patient</em>, <em>res</em>, <em>factor</em>, <em>shape_resize</em>, <em>spacing=(1</em>, <em>1</em>, <em>1)</em>, <em>shape=(128</em>, <em>256</em>, <em>256)</em>, <em>method='pil-simd'</em>, <em>order=3</em>, <em>padding='edge'</em>, <em>axes_pairs=None</em>, <em>resample=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/radio/preprocessing/ct_batch.html#CTImagesBatch.unify_spacing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#radio.CTImagesBatch.unify_spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>Unify spacing of all patients.</p>
<p>Resize all patients to meet <cite>spacing</cite>, then crop/pad resized array to meet <cite>shape</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>spacing</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of float</em>) – (z,y,x)-spacing after resize.
Should be passed as key-argument.</li>
<li><strong>shape</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.6)"><em>list</em></a><em> or </em><em>ndarray of int</em>) – (z,y,x)-shape after crop/pad.
Should be passed as key-argument.</li>
<li><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – interpolation method (‘pil-simd’ or ‘resize’).
Should be passed as key-argument.
See CTImagesBatch.resize for more information.</li>
<li><strong>order</strong> (<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.6)"><em>int</em></a>) – order of scipy-interpolation (&lt;=5), if used.
Should be passed as key-argument.</li>
<li><strong>padding</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – mode of padding, any supported by np.pad.
Should be passed as key-argument.</li>
<li><strong>axes_pairs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a><em>, </em><em>list of tuples with pairs</em>) – pairs of axes that will be used consequentially
for performing pil-simd resize.
Should be passed as key-argument.</li>
<li><strong>resample</strong> (<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.6)"><em>None</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – filter of pil-simd resize.
Should be passed as key-argument</li>
<li><strong>patient</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.6)"><em>str</em></a>) – index of patient, that worker is handling.
Note: this argument is passed by inbatch_parallel</li>
<li><strong>out_patient</strong> (<em>ndarray</em>) – result of individual worker after action.
Note: this argument is passed by inbatch_parallel</li>
<li><strong>res</strong> (<em>ndarray</em>) – New <cite>images</cite> to replace data inside <cite>images</cite> component.
Note: this argument is passed by inbatch_parallel</li>
<li><strong>factor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a>) – (float), factor to make resize by.
Note: this argument is passed by inbatch_parallel</li>
<li><strong>shape_resize</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.6)"><em>tuple</em></a>) – It is possible to provide <cite>shape_resize</cite> argument (shape after resize)
instead of spacing. Then array with <cite>shape_resize</cite>
will be cropped/padded for shape to = <cite>shape</cite> arg.
Note that this argument is passed by inbatch_parallel</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>see CTImagesBatch.resize for more info about methods’ params.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">unify_spacing</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="go">                                order=2, method=&#39;scipy&#39;, padding=&#39;reflect&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">unify_spacing</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="go">                                resample=PIL.Image.BILINEAR)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="radio.CTImagesBatch.upper_bounds">
<code class="descname">upper_bounds</code><a class="headerlink" href="#radio.CTImagesBatch.upper_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Get upper bounds of patients data in CTImagesBatch.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">ndarray(n_patients,) containing
upper bounds of patients data along z-axis.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="api.html"
                        title="previous chapter">API</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="masked_batch.html"
                        title="next chapter">CTImagesMaskedBatch</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/ct_batch.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="masked_batch.html" title="CTImagesMaskedBatch"
             >next</a> |</li>
        <li class="right" >
          <a href="api.html" title="API"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">RadIO 0.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="api.html" >API</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, analysiscenter.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>